import socket

import re

TCP_IP='192.168.1.230'
TCP_PORT= 8080
BUFFER_SIZE=1024

def main(inputQ,outputQ):
	s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	
	# Uncomment this line when actually running
	s.bind((TCP_IP, TCP_PORT))

	s.listen(1)

	conn, addr = s.accept()

	tempRe = re.compile('temp')
	

testTemp = "37"

	print('Connection address:', addr)
	while True:
		#Attempts to get data from connection, if successful adds to input queue	
		data=conn.recv(BUFFER_SIZE).decode()
		if len(data) > 0:
			inputQ.put(data)
		if not inputQ.empty():
			recieved = inputQ.get()
			if tempRe.search(recieved):
				outputQ.put(testTemp)
			else:
				outputQ.put(recieved)
			print("Recieved data: ", recieved)
		#if not data: break
		
		# If output is not empty
		if (outputQ.empty() == False):
		# Gets first item from output queue and sends to lower Pi	
			message = outputQ.get()
			conn.send(message.encode())
#	if not data: break
#	print('recieved data:', data)
			#conn.send(data.encode())
	conn.close()
	return 0
